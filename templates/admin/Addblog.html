<!doctype html>
<html lang="en" dir="ltr">


<head>
	
	<meta charset="UTF-8">
	<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=0'>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="Description" content="قالب ادمینِتو - بهینه شده با بوت استرپ">
	<meta name="Author" content="برنامه نویسان ادمینتو">
	<meta name="Keywords" content="قالب مدیریت ادمنتو , داشبورد مدیریتی , تم مدیریتی , قالب  html , قالب  مدیریت بوت استرپ  , طراحی قالب مدیریت , طراحی قالب ادمین">

	<!-- Title -->
	<title>افزودن وبلاگ</title>

	<!-- Favicon -->
	<link rel="icon" href="../static/assets/img/brand/favicon.png" type="image/x-icon">

	<!-- styles code -->
	<!-- Bootstrap css -->
	<link href="../static/assets/plugins/bootstrap/css/bootstrap.css" rel="stylesheet" id="style">

	<!-- Style css -->
	<link href="../static/assets/css/style.css" rel="stylesheet">
	<link href="../static/assets/css/plugins.css" rel="stylesheet">
    <!-- Font css -->
	<link href="../static/assets/font/Morabba/fontiran.css" rel="stylesheet">
	<!-- Icons css -->
	<link href="../static/assets/css/icons.css" rel="stylesheet">

	<!-- Animations css -->
	<link href="../static/assets/css/animate.css" rel="stylesheet">



	<!-- Switcher css -->
	<link href="../static/assets/switcher/css/switcher.css" rel="stylesheet">
	<link href="../static/assets/switcher/demo.css" rel="stylesheet">

	<!-- End styles -->

</head>

<body class="main-body app sidebar-mini ltr">

	<!-- Loader -->
	<div id="global-loader">
		<img src="../static/assets/img/loaders/loader-4.svg" class="loader-img" alt="Loader">
	</div>
	<!-- /Loader -->
	<!-- page -->
	<div class="page custom-index">

        <!-- app header code -->
        {% include "all_user_headr.html" %}

        <!-- End app header Code -->



        <!-- app sidebar Code -->
         {% include "admin/admin_base.html" %}

        <!-- End app sidebar Code -->

		<!-- main-content -->
		<div class="main-content app-content">

			<!-- container -->
			<div class="main-container container-fluid">


				<!-- breadcrumb -->
				<div class="breadcrumb-header justify-content-between">
					<div>
						<!-- <h4 class="content-title mb-2 mb-xl-0">ویرایش پست</h4> -->
					</div>
					<div class="d-flex my-auto">
						<nav aria-label="breadcrumb">
							<ol class="breadcrumb">
								<!-- <li class="breadcrumb-item"><a href="javascript:void(0);">رابط کاربری پیشرفته</a></li>
								<li class="breadcrumb-item active " aria-current="page">ویرایش پست</li> -->
							</ol>
						</nav>
					</div>
				</div>
				<!-- /breadcrumb -->
				<!-- row -->
				<div class="row">
					<div class="col-lg-12 col-md-12 col-md-12">
						<div class="card blog-edit">
							<div class="card-header bg-primary text-white ">
								<div class="card-title">افزودن وبلاگ جدید</div>
							</div>
							<div class="card-body">
								<div class="container mt-5 mb-4">
									<div class="card">
										<div class="card-body">
											<form id="addBlogForm">
												<div class="form-group mb-3">
													<label class="form-label">عنوان وبلاگ</label>
													<input type="text" class="form-control" name="title" required>
												</div>
												<div class="form-group mb-3">
													<label class="form-label">متن وبلاگ</label>
													<div id="blogTextEditor"></div>
												</div>
												<div class="form-group mb-3">
													<label class="form-label">عکس (jpg/png)</label>
													<input type="file" class="form-control" accept="image/*" id="blogImageInput">
													<div class="mt-2">
														<img id="blogImagePreview" src="#" alt="پیش‌نمایش عکس" style="max-width: 200px; display: none;"/>
													</div>
												</div>
												<div class="form-group mb-3">
													<label class="form-label">ویدیو (mp4)</label>
													<input type="file" class="form-control" accept="video/*" id="blogVideoInput">
													<div class="mt-2">
														<video id="blogVideoPreview" controls style="max-width: 300px; display: none;"></video>
													</div>
												</div>
												<div class="form-group mb-3">
													<label class="form-label">برچسب‌ها (با کاما جدا کنید)</label>
													<input type="text" class="form-control" name="tags" placeholder="مثال: برنامه‌نویسی, وب, آموزش">
												</div>
												<div class="form-group mb-3">
													<label class="form-label">دسته‌بندی</label>
													<select class="form-control form-select" name="category" required>
														<option value="">انتخاب کنید</option>
														<option value="it">آی تی</option>
														<option value="language">زبان</option>
														<option value="science">علوم پایه</option>
														<option value="health">سلامتی</option>
														<option value="human">علوم انسانی</option>
														<option value="business">کسب و کار</option>
														<option value="math">ریاضی</option>
														<option value="marketing">بازار یابی</option>
													</select>
												</div>
												<button type="submit" class="btn btn-success">افزودن وبلاگ</button>
											</form>
										</div>
									</div>
								</div>
							</div>
							<!-- <div class="card-footer ">
								<a href="javascript:void(0)" class="btn btn-secondary">ذخیره در پیش نویس</a>
								<a href="javascript:void(0)" class="btn btn-primary float-end">اکنون منتشر کنید</a>
							</div> -->
						</div>
					</div>
				</div>
				<!-- /row -->
                <div class="row">
                    	<!-- Blog List Section -->
                    <div class="container mb-5" id="blogListSection">
                        <div class="card mt-5">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0">لیست وبلاگ‌ها</h5>
                            </div>
                            <div class="card-body">
                                <div id="blogList" class="row g-3"></div>
                                <div id="noBlogs" class="text-center text-muted">هنوز وبلاگی ثبت نشده است.</div>
                            </div>
                        </div>
                    </div>
                </div>


			</div>
			<!-- Container closed -->
		</div>
		<!-- main-content closed -->
		<!-- Footer code -->

		<div class="main-footer ht-45">
			<div class="container-fluid pd-t-0 ht-100p">
				<span>   <a href="javascript:void(0);" class="text-primary">ادمینِتو</a>. طراحی شده با عشق <span class="fa fa-heart text-danger"></span> توسط  <a href="javascript:void(0);"> برنامه نویسان  </a> ادمینِتو</span>
			</div>
		</div>            <!-- End Footer -->

	</div>
	<!-- End Page -->
	<!-- scripts code -->
	<!-- Back-to-top -->
	<a href="#top" id="back-to-top"><i class="las la-angle-double-up"></i></a>

	<!-- JQuery min js -->
	<script src="../static/assets/plugins/jquery/jquery.min.js"></script>

	<!-- Bootstrap Bundle js -->
	<script src="../static/assets/plugins/bootstrap/popper.min.js"></script>
	<script src="../static/assets/plugins/bootstrap/js/bootstrap.min.js"></script>

	<!-- Ionicons js -->
	<script src="../static/assets/plugins/ionicons/ionicons.js"></script>

	<!-- Moment js -->
	<script src="../static/assets/plugins/moment/moment.js"></script>

	<!-- JQuery sparkline js -->
	<script src="../static/assets/plugins/jquery-sparkline/jquery.sparkline.min.js"></script>

	<!-- P-scroll js -->
	<script src="../static/assets/plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>
	<script src="../static/assets/plugins/perfect-scrollbar/p-scroll.js"></script>

	<!-- Switcher js -->
	<script src="../static/assets/switcher/js/switcher.js"></script>

	<!-- Eva-icons js -->
	<script src="../static/assets/js/eva-icons.min.js"></script>

	<!-- Sidebar js -->
	<script src="../static/assets/plugins/side-menu/sidemenu.js"></script>

	<!-- sticky js -->
	<script src="../static/assets/js/sticky.js"></script>

	<!--- Index js -->
	<script src="../static/assets/js/script.js"></script>


	<!--Internal quill js -->
	<script src="../static/assets/plugins/quill/quill.min.js"></script>

	<!-- Ionicons js -->
	<script src="../static/assets/plugins/ionicons/ionicons.js"></script>

	<!-- JQuery sparkline js -->
	<script src="../static/assets/plugins/jquery-sparkline/jquery.sparkline.min.js"></script>

	<!-- Eva-icons js -->
	<script src="../static/assets/js/eva-icons.min.js"></script>

	<!--- Select2 js -->
	<script src="../static/assets/plugins/select2/js/select2.min.js"></script>

	<!-- Internal Select2.min js -->
	<script src="../static/assets/plugins/select2/js/select2.min.js"></script>
	<script src="../static/assets/js/select2.js"></script>

	<!--Internal Fileuploads js-->
	<script src="../static/assets/plugins/fileuploads/js/fileupload.js"></script>
	<script src="../static/assets/plugins/fileuploads/js/file-upload.js"></script>

	<!--Internal Fancy uploader js-->
	<script src="../static/assets/plugins/fancyuploder/jquery.ui.widget.js"></script>
	<script src="../static/assets/plugins/fancyuploder/jquery.fileupload.js"></script>
	<script src="../static/assets/plugins/fancyuploder/jquery.iframe-transport.js"></script>
	<script src="../static/assets/plugins/fancyuploder/jquery.fancy-fileupload.js"></script>
	<script src="../static/assets/plugins/fancyuploder/fancy-uploader.js"></script>

	<!-- Internal Form-editor js -->
	<script src="../static/assets/js/form-editor-2.js"></script>

	<!--- Index js -->
	<script src="../static/assets/js/script.js"></script>


	<!--themecolor js-->
	<script src="../static/assets/js/themecolor.js"></script>

	<!--swither-styles js-->
	<script src="../static/assets/js/swither-styles.js"></script>

	<!-- Custom js -->
	<script src="../static/assets/js/custom.js"></script>      
	
	
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    window.quill = new Quill("#blogTextEditor", {
        theme: "snow",
        placeholder: "متن وبلاگ را وارد کنید..."
    });
});
</script>
	<!-- End scripts -->


	<script>
document.getElementById('addBlogForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = new FormData();

    const title = this.querySelector('[name="title"]').value;
    const tags = this.querySelector('[name="tags"]').value;
    const category = this.querySelector('[name="category"]').value;

    // Get HTML content from the editor (assume you're using Quill)
    const content = quill.root.innerHTML;

    // Append basic data
    formData.append('title', title);
    formData.append('content', content);
    formData.append('tags', tags);
    formData.append('category', category);

    // Attach either image or video (not both)
    const image = document.getElementById('blogImageInput').files[0];
    const video = document.getElementById('blogVideoInput').files[0];
    if (image) {
        formData.append('media', image);
    } else if (video) {
        formData.append('media', video);
    }

    fetch('/api/blog', {
        method: 'POST',
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === 'success') {
            alert("✅ پست با موفقیت اضافه شد!");
            this.reset();
            document.getElementById('blogImagePreview').style.display = 'none';
            document.getElementById('blogVideoPreview').style.display = 'none';
            quill.setText('');
            // reload blog list or redirect
        } else {
            alert("❌ خطا در ارسال پست!");
        }
    });
});
</script>

	<script>
	// پیش‌نمایش عکس
	const imageInput = document.getElementById('blogImageInput');
	const imagePreview = document.getElementById('blogImagePreview');
	imageInput.addEventListener('change', function(e) {
		const file = e.target.files[0];
		if (file) {
			const reader = new FileReader();
			reader.onload = function(ev) {
				imagePreview.src = ev.target.result;
				imagePreview.style.display = 'block';
			}
			reader.readAsDataURL(file);
		} else {
			imagePreview.style.display = 'none';
		}
	});
	// پیش‌نمایش ویدیو
	const videoInput = document.getElementById('blogVideoInput');
	const videoPreview = document.getElementById('blogVideoPreview');
	videoInput.addEventListener('change', function(e) {
		const file = e.target.files[0];
		if (file) {
			const url = URL.createObjectURL(file);
			videoPreview.src = url;
			videoPreview.style.display = 'block';
		} else {
			videoPreview.style.display = 'none';
		}
	});
	// ویرایشگر متنی Quill
	if (window.Quill) {
		new Quill('#blogTextEditor', { theme: 'snow', placeholder: 'متن وبلاگ را وارد کنید...' });
	}
	</script>

	<script>
	// بلاگ‌ها را اینجا نگه می‌داریم
	let blogs = [];
	let editIndex = null;

	function renderBlogList() {
		const blogList = document.getElementById('blogList');
		const noBlogs = document.getElementById('noBlogs');
		blogList.innerHTML = '';
		if (blogs.length === 0) {
			noBlogs.style.display = 'block';
			return;
		}
		noBlogs.style.display = 'none';
		// جدول
		const table = document.createElement('table');
		table.className = 'table table-hover align-middle table-bordered bg-white shadow-sm rounded';
		table.innerHTML = `
			<thead class="table-light">
				<tr>
					<th style="width:70px">عکس</th>
					<th>عنوان</th>
					<th style="width:120px">دسته‌بندی</th>
					<th style="width:110px">عملیات</th>
				</tr>
			</thead>
			<tbody>
				${blogs.map((blog, idx) => `
					<tr>
						<td class="text-center">
							${blog.image ? `<img src="${blog.image}" style="width:56px;height:56px;object-fit:cover;border-radius:8px;">` : `<span class='text-muted'>بدون عکس</span>`}
						</td>
						<td style="max-width:180px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${blog.title}</td>
						<td><span class="badge bg-info text-white px-3 py-2" style="font-size:0.95rem;border-radius:12px;">${blog.category || ''}</span></td>
						<td class="text-center">
							<button class="btn btn-light btn-sm rounded-circle shadow-sm ms-1" onclick="editBlog(${idx})" title="ویرایش"><i class="fe fe-edit"></i></button>
							<button class="btn btn-light btn-sm rounded-circle shadow-sm" onclick="deleteBlog(${idx})" title="حذف"><i class="fe fe-trash"></i></button>
						</td>
					</tr>
				`).join('')}
			</tbody>
		`;
		blogList.appendChild(table);
	}

	// حذف بلاگ
	window.deleteBlog = function(idx) {
		if (confirm('آیا از حذف این وبلاگ مطمئن هستید؟')) {
			blogs.splice(idx, 1);
			// اگر در حال ویرایش همین بلاگ بودیم، فرم را ریست کن
			if (editIndex === idx) {
				addBlogForm.reset();
				document.getElementById('blogImagePreview').style.display = 'none';
				document.getElementById('blogVideoPreview').style.display = 'none';
				if (window.Quill) {
					const quill = Quill.find(document.getElementById('blogTextEditor'));
					if (quill) quill.setContents([]);
				}
				editIndex = null;
				setAddButtonToAdd();
			}
			renderBlogList();
		}
	};

	// تغییر دکمه افزودن به حالت ویرایش و بالعکس
	function setAddButtonToEdit() {
		const btn = addBlogForm.querySelector('button[type="submit"]');
		btn.textContent = 'ذخیره ویرایش';
		btn.classList.remove('btn-success');
		btn.classList.add('btn-primary');
	}
	function setAddButtonToAdd() {
		const btn = addBlogForm.querySelector('button[type="submit"]');
		btn.textContent = 'افزودن وبلاگ';
		btn.classList.remove('btn-primary');
		btn.classList.add('btn-success');
	}

	// هندل ارسال فرم
	const addBlogForm = document.getElementById('addBlogForm');
	addBlogForm.addEventListener('submit', function(e) {
		e.preventDefault();
		const title = addBlogForm.title.value;
		const text = document.querySelector('#blogTextEditor .ql-editor') ? document.querySelector('#blogTextEditor .ql-editor').innerHTML : '';
		const tags = addBlogForm.tags.value;
		const category = addBlogForm.category.value;
		const image = document.getElementById('blogImagePreview').src && document.getElementById('blogImagePreview').style.display !== 'none' ? document.getElementById('blogImagePreview').src : '';
		const video = document.getElementById('blogVideoPreview').src && document.getElementById('blogVideoPreview').style.display !== 'none' ? document.getElementById('blogVideoPreview').src : '';
		const blogData = { title, text, tags, category, image, video };
		if (editIndex !== null) {
			blogs[editIndex] = blogData;
			editIndex = null;
			setAddButtonToAdd();
		} else {
			blogs.push(blogData);
		}
		addBlogForm.reset();
		document.getElementById('blogImagePreview').style.display = 'none';
		document.getElementById('blogVideoPreview').style.display = 'none';
		if (window.Quill) {
			const quill = Quill.find(document.getElementById('blogTextEditor'));
			if (quill) quill.setContents([]);
		}
		renderBlogList();
	});

	// تابع ویرایش
	window.editBlog = function(idx) {
		const blog = blogs[idx];
		addBlogForm.title.value = blog.title;
		if (window.Quill) {
			const quill = Quill.find(document.getElementById('blogTextEditor'));
			if (quill) quill.root.innerHTML = blog.text;
		} else {
			document.getElementById('blogTextEditor').innerHTML = blog.text;
		}
		addBlogForm.tags.value = blog.tags;
		addBlogForm.category.value = blog.category;
		// عکس
		if (blog.image) {
			document.getElementById('blogImagePreview').src = blog.image;
			document.getElementById('blogImagePreview').style.display = 'block';
		} else {
			document.getElementById('blogImagePreview').style.display = 'none';
		}
		// ویدیو
		if (blog.video) {
			document.getElementById('blogVideoPreview').src = blog.video;
			document.getElementById('blogVideoPreview').style.display = 'block';
		} else {
			document.getElementById('blogVideoPreview').style.display = 'none';
		}
		editIndex = idx;
		setAddButtonToEdit();
		window.scrollTo({top: 0, behavior: 'smooth'});
	};

	// استایل سفارشی برای کارت‌ها و دکمه‌ها
	(function addBlogCardStyles() {
		const style = document.createElement('style');
		style.innerHTML = `
			.blog-card-custom:hover {
				box-shadow: 0 8px 32px 0 rgba(68,84,195,0.15), 0 1.5px 6px 0 rgba(0,0,0,0.07);
				transform: translateY(-2px) scale(1.02);
			}
			.blog-card-actions button {
				opacity: 0.85;
				transition: background 0.2s, opacity 0.2s;
			}
			.blog-card-actions button:hover {
				background: #4454c3 !important;
				color: #fff !important;
				opacity: 1;
			}
		`;
		document.head.appendChild(style);
	})();

	renderBlogList();
	</script>

</body>



</html>